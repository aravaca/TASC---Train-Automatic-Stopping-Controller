# Advanced TASC-Based Stop Training Simulator for JR East E233 Series
**JR East E233 시리즈 TASC 기반 정차 훈련 시뮬레이터**

이 풀스택 프로젝트는 **JR East E233**를 모델로 한 정차 훈련용 시뮬레이터입니다.  
프론트엔드(HTML/CSS/JS) + 백엔드(FastAPI WebSocket)를 통합하여, **브레이크 내비게이션 캔버스**(거리-속도 곡선)와 **TASC(자동 정차 보조)**를 활용한 **실시간 제동 연습**과 **피드백/점수 평가**를 제공합니다.

---

## ✨ What’s New (주요 업데이트)
- **TASC 오토파일럿**:
  - 초제동 자동(B1 또는 **70km/h↑ 시 B2** 고정 1초)
  - **계단 제동(build)**: 빨간 “남은 거리” 세로선과 노치별 제동거리 곡선을 비교해 필요 시 한 단계씩 강화
  - **계단 완해(relax)**: 더 낮은 노치로도 정지 가능하면 **한 단계씩** 완해하면서 B1로 마무리
  - **데드밴드 & 최소 유지시간**으로 헌팅 방지, 승차감 향상
  - 수동 개입(키/터치) 시 즉시 **Manual**로 전환
- **브레이크 내비게이션 캔버스**:
  - 노치별 제동 곡선과 남은 거리의 교차점을 실시간 시각화 → **언제 브레이크/완해할지 직관적으로 학습**
- **스코어 개선**:
  - 초제동(B1/B2 1초) 수행 가점
  - 마지막 **B1 정차 가점**
  - **0cm 정차(+100점)** 보너스 추가
  - **저크(Jerk)** 기반 승차감 점수 반영
  - TASC ON 시 단계 점프 허용(완해/계단 패턴 패널티 면제), 단 **수동 개입으로 패턴을 깬 경우 감점**
- **환경 요소**: 눈/비 애니메이션, 구배/마찰계수(날씨) 반영, 탑승률에 따른 총중량 반영

---

## 🧠 Why TASC? (TASC의 가치)
- **운전자의 부담·피로 감소**: 반복 구간에서 자동으로 초제동·계단제동·완해를 수행 → 인지 부하와 조작 피로 ↓
- **정차 정확도↑ / 승차감 일관성↑**: 데드밴드와 홀드 타임으로 불필요한 노치 헌팅을 방지, 항상 **비슷한 프로파일**로 제동
- **훈련 효율↑**:
  - **브레이크 내비 캔버스**로 “곡선과 빨간선이 만날 때”의 타이밍 감각을 체득
  - **피드백/점수**로 본인의 습관을 정량적으로 점검
- **교육/검증용**: 시나리오(거리/구배/속도/마찰) 다양화, **승차감(저크)**과 **정차 정밀도**를 같이 평가

---

## ⚙️ Tech Stack
- **Backend**: Python 3.12, FastAPI, WebSocket
- **Frontend**: HTML, CSS, JavaScript (Canvas 기반 HUD)
- **Deploy**: AWS EC2 (Amazon Linux), Nginx, Route53

---

## 🖥 UI & Controls (조작)
- **표시**: 남은 거리, 현재 속도, 경과 시간, 경사도, 현재 노치
- **브레이크 내비 캔버스**:
  - X축=거리, Y축=속도
  - 노치별 제동 곡선들과 **빨간 세로선(남은 거리)**의 교차가 “제동/완해 타이밍”
- **키보드**:
  - `Space` 시작/재시작
  - `W` 브레이크 강화(노치↑)
  - `S` 완해(노치↓)
  - `N` 해방
- **모바일**: 캔버스 상단 터치=강화, 하단 터치=완해
- **TASC 토글**: 오버레이 우측 상단 **ON/OFF 스위치**. 켜면 오토파일럿, 수동 입력 시 즉시 OFF.

---

## 🧩 Scoring (점수 체계 개요)
- **정지 오차**: 0m → +500, 10m → 0 (선형)
- **초제동(B1/B2 1초)**: +300 (미수행 시 −100)
- **B1 정차**: +300 (N 또는 B2↑ 정차 시 −100)
- **EB 사용**: −500
- **저크 승차감**: 최근 1초 평균 저크 + 페널티 팩터로 계산(≤25: +500, 25~50: 선형 감점, >50: 0)
- **0cm 정차 보너스**: +100
- **계단 패턴**:
  - 수동: 계단제동/완해 패턴 충족 시 +500
  - **TASC ON** & 수동 개입 없음: 점프가 있어도 +500 인정
  - **TASC ON 중 사람이 패턴을 깨면** 감점(일반 규칙 적용)

---

## 🔧 Project Structure

. ├── scenario.json          # 시나리오(거리 L, 초기속도 v0, 경사, 마찰 등) ├── vehicle.json           # 차량 제원(질량, notch_accels, 시간상수 등) ├── server.py              # FastAPI + WebSocket 서버, TASC 로직 포함 └── static/ ├── index.html         # UI (HUD/오버레이/TASC 스위치/애니메이션) └── carName.json       # 차량 이름 표시용

---

## 🚀 Run (로컬 실행)
1. (선택) 가상환경 준비 후 패키지 설치
```bash
pip install fastapi uvicorn

2. 서버 실행



uvicorn server:app --host 0.0.0.0 --port 8000 --reload

3. 브라우저에서 접속
http://localhost:8000/ → HUD/오버레이 UI 실행



> 배포 환경(Nginx/Route53/AWS EC2)은 서비스 설정에 따라 달라질 수 있습니다.




---

🧪 How TASC Works (알고리즘 요약)

초제동:

속도 ≥ 70km/h → B2 1초 유지

속도 < 70km/h → B1 1초 유지


계단 제동 (build):

현재 노치 정지거리 s_cur > (rem - 데드밴드) → 한 단계 강화(↑)

충분해지면 완해 단계로 전환


계단 완해 (relax):

한 단계 아래 노치 정지거리 s_dn ≤ (rem + 데드밴드) → 한 단계 완해(↓)

이를 반복, B1로 마무리


안정화 장치:

**데드밴드(±m)**와 **최소 유지시간(s)**으로 헌팅/덜컹 방지

저속/근거리에서 B1 바이어스로 승차감 개선




---

⚙️ Configuration (설정 포인트)

vehicle.json

notch_accels: [N, B1, B2, ..., EB] 순서(서버에서 반전 사용)

tau_cmd_ms, tau_brk_ms: 제어/제동 지연 상수

mass_t: 1량 기준 질량 (총질량=편성 수 × 탑승률)


scenario.json

L(정차 목표 거리), v0(초기 속도), grade_percent, mu(마찰)




---

🛡 Troubleshooting

웹에 이전 버전이 보임:

브라우저 캐시/서비스워커/CloudFront 캐시 삭제

Nginx/EC2에서 static/ 최신 배포 확인


HUD에 EB 곡선 미표시:

vehicle.notches / notch_accels 길이와 프론트 렌더 순서 확인

서버는 [N..EB] 배열을 반전 사용


TASC 완해 안 됨:

tasc_deadband_m을 0.3~0.8로 조정

tasc_hold_min_s를 0.2~0.35로 조정




---

🗺 Roadmap

곡선/정차 위치 학습(ML) 기반 TASC 적응형 파라미터 튜닝

차종별 제동특성/열차 길이 프리셋

더 세밀한 승차감 모델(좌우 흔들림/슬립 탐지)

리플레이/고스트 오버레이(자기 최고 기록과 비교)



---

📄 License

MIT License © 2025 Hyungsuk Choi, University of Maryland


---

📌 교육·연습 활용 팁

브레이크 내비 캔버스에서 “빨간선과 곡선이 만나는 지점”을 노려 계단 제동·완해 타이밍을 읽어보세요.

TASC ON 상태에서 자동 프로파일을 관찰한 뒤, 수동으로 동일한 패턴을 재현해보면 실력이 빠르게 향상됩니다.

0cm 정차 보너스를 노리며 저크 점수도 신경 쓰면, 정확도+승차감 둘 다 잡을 수 있습니다.



